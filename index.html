<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>WebP to PNG Converter | Secure & Serverless</title>
    <meta name="description" content="Convert WebP images to PNG instantly in your browser. 100% local processing, no uploads, strict privacy. Optimized for developers and designers.">
    <meta name="keywords" content="webp to png, image converter, local processing, privacy, dev tool, secure converter">
    <meta name="author" content="Architect Zero">

    <link rel="canonical" href="https://architectzero.xyz" />
    <meta property="og:type" content="website">
    <meta property="og:title" content="WebP to PNG - Secure & Local">
    <meta property="og:description" content="Convert images instantly without sending files to the cloud.">
    <meta property="og:url" content="https://architectzero.xyz">
    <meta property="og:image" content="https://architectzero.xyz/og-image.png">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”’</text></svg>">
    
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

    <style>
        /* =========================================
           DESIGN TOKENS
           ========================================= */
        :root {
            /* Palette */
            --bg-app: #fafafa;
            --bg-surface: #ffffff;
            --fg-primary: #111111;
            --fg-secondary: #666666;
            --fg-tertiary: #888888;
            
            /* Accents */
            --accent-blue: #0070f3;
            --accent-warning-bg: #fffbf0;
            --accent-warning-fg: #b5850b;
            --accent-success-bg: #d3e5ff;
            --accent-success-fg: #0070f3;
            --accent-error-bg: #fff0f0;
            --accent-error-fg: #e00000;
            
            /* Borders & Shadows */
            --border-light: #eaeaea;
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            
            /* Dimensions */
            --radius-lg: 12px;
            --max-width: 680px;
        }

        /* =========================================
           RESET & BASE
           ========================================= */
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-app);
            color: var(--fg-primary);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            line-height: 1.6;
        }

        main {
            width: 100%;
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 60px 20px;
            flex: 1;
        }

        /* =========================================
           HEADER
           ========================================= */
        header { text-align: center; margin-bottom: 40px; }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.04em;
            margin: 0 0 16px 0;
            color: var(--fg-primary);
        }

        .privacy-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            padding: 6px 12px;
            border-radius: 99px;
            font-size: 0.8rem;
            color: var(--fg-secondary);
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .privacy-pill svg { width: 12px; height: 12px; color: var(--fg-primary); }

        /* =========================================
           COMPONENTS
           ========================================= */
        .drop-zone {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            box-shadow: var(--shadow-card);
        }
        .drop-zone:hover { border-color: #999; transform: translateY(-1px); box-shadow: var(--shadow-hover); }
        .drop-zone.drag-over { border-color: var(--accent-blue); background: #f7faff; transform: scale(0.99); }

        .dz-icon { color: var(--fg-tertiary); margin-bottom: 16px; transition: color 0.2s; }
        .drop-zone:hover .dz-icon { color: var(--fg-primary); }
        .dz-title { font-size: 1.1rem; font-weight: 600; color: var(--fg-primary); margin-bottom: 8px; }
        .dz-sub { font-size: 0.9rem; color: var(--fg-secondary); margin-bottom: 24px; }

        .btn-trigger {
            background: var(--fg-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-trigger:hover { background: #333; }

        /* Progress Bar */
        .progress-container { margin-top: 32px; display: none; }
        .progress-meta { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--fg-secondary); margin-bottom: 8px; font-weight: 500; }
        .progress-track { height: 4px; background: var(--border-light); border-radius: 99px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--fg-primary); width: 0%; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Actions */
        .actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 32px; margin-bottom: 24px; flex-wrap: wrap; align-items: center; }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            height: 40px;
        }
        .btn-outline { background: transparent; border: 1px solid var(--border-light); color: var(--fg-secondary); }
        .btn-outline:hover { border-color: var(--fg-primary); color: var(--fg-primary); }
        .btn-success { background: var(--fg-primary); border: 1px solid var(--fg-primary); color: white; }
        .btn-success:hover { background: #333; border-color: #333; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* File List */
        .file-list { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .file-item {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .file-info { display: flex; align-items: center; gap: 12px; overflow: hidden; }
        .file-name { font-size: 0.9rem; font-weight: 500; color: var(--fg-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px; }
        
        .status-badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 99px; font-weight: 600; text-transform: uppercase; }
        .status-done { background: var(--accent-success-bg); color: var(--accent-success-fg); }
        .status-error { background: var(--accent-error-bg); color: var(--accent-error-fg); }

        .single-dl-link { font-size: 0.85rem; font-weight: 500; color: var(--fg-primary); text-decoration: none; border-bottom: 1px solid transparent; }
        .single-dl-link:hover { border-bottom-color: var(--fg-primary); }

        /* Warning Box (Mobile Limit) */
        .warning-box {
            background: var(--accent-warning-bg);
            color: var(--accent-warning-fg);
            border: 1px solid #f0e6ce;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 16px;
            display: none; /* JS Toggled */
            width: 100%;
            text-align: center;
        }

        /* Support Button Responsive Label */
        .coffee-label { display: none; }
        @media(min-width: 600px) {
            .coffee-label { display: inline; }
        }

        /* How It Works Section */
        .info-section { margin-top: 60px; }
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-top: 24px; }
        .step-card { background: var(--bg-surface); padding: 24px; border-radius: var(--radius-lg); border: 1px solid var(--border-light); }
        .step-number { font-weight: 700; color: var(--accent-blue); margin-bottom: 12px; font-size: 1.2rem; }
        .step-title { font-weight: 600; color: var(--fg-primary); margin-bottom: 8px; }
        .step-desc { font-size: 0.9rem; color: var(--fg-secondary); }

        /* =========================================
           FAQ SECTION (SEO Semantic)
           ========================================= */
        .faq-section {
            margin-top: 60px;
            border-top: 1px solid var(--border-light);
            padding-top: 40px;
        }
        .faq-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 24px; color: var(--fg-primary); }
        
        details {
            border-bottom: 1px solid var(--border-light);
            padding: 16px 0;
            cursor: pointer;
        }
        details summary {
            font-weight: 600;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        details summary::-webkit-details-marker { display: none; }
        details summary::after { content: "+"; font-size: 1.2rem; color: var(--fg-secondary); }
        details[open] summary::after { content: "-"; }
        
        .faq-content {
            padding-top: 12px;
            color: var(--fg-secondary);
            font-size: 0.95rem;
        }

        /* Footer */
        footer { text-align: center; padding: 40px; font-size: 0.8rem; color: var(--fg-tertiary); margin-top: 40px; }

        @media (max-width: 600px) {
            main { padding: 30px 16px; }
            h1 { font-size: 2rem; }
            .file-name { max-width: 140px; }
            .actions { flex-direction: row; flex-wrap: wrap; }
            .steps-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <main>
        <header>
            <div class="privacy-pill">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                ðŸ”’ Secure Local Processing
            </div>
            <h1>WebP to PNG Converter</h1>
        </header>

        <section class="drop-zone" id="dropZone">
            <div class="dz-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
            </div>
            <div class="dz-title">Drag & Drop WebP files</div>
            <div class="dz-sub">Local processing. No images leave your device.</div>
            
            <button class="btn-trigger" onclick="document.getElementById('fileInput').click()">Select Files</button>
            <input type="file" id="fileInput" multiple accept="image/webp" style="display: none;">
        </section>

        <div class="progress-container" id="progressContainer">
            <div class="progress-meta">
                <span id="progressText">Starting...</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="actions" id="actionArea" style="display: none;">
            <a href="https://buymeacoffee.com/architectzerodev" 
               target="_blank" 
               rel="noopener noreferrer"
               class="btn btn-outline"
               style="margin-right: auto; border-color: var(--border-light); color: var(--fg-primary);"> 
               <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                     <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path>
                </svg>
                <span class="coffee-label" style="font-weight: 600;">Support the Project</span>
            </a>

            <button id="btnReset" class="btn btn-outline">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                </svg>
                Clear
            </button>

            <button id="btnDownloadAll" class="btn btn-success">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download ZIP
            </button>
        </div>

        <div id="mobileWarning" class="warning-box">
            Memory Protection Active: Total size exceeds 50MB. ZIP download disabled to prevent browser crash. Please download files individually.
        </div>

        <div id="fileList" class="file-list"></div>

        <section id="how-it-works" class="info-section">
            <h2 class="faq-title" style="margin-bottom: 16px;">How It Works</h2>
            <div class="steps-grid">
                <article class="step-card">
                    <div class="step-number">01</div>
                    <h3 class="step-title">Select Files</h3>
                    <p class="step-desc">Drag and drop your WebP images directly into the browser. No cloud uploads required.</p>
                </article>
                <article class="step-card">
                    <div class="step-number">02</div>
                    <h3 class="step-title">Local Conversion</h3>
                    <p class="step-desc">Our engine converts binary data instantly using your device's processing power.</p>
                </article>
                <article class="step-card">
                    <div class="step-number">03</div>
                    <h3 class="step-title">Save & Secure</h3>
                    <p class="step-desc">Download your PNGs individually or as a ZIP. Data is wiped upon refresh.</p>
                </article>
            </div>
        </section>

        <section class="faq-section" itemscope itemtype="https://schema.org/FAQPage">
            <h2 class="faq-title">Frequently Asked Questions</h2>
            
            <details itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Are my images uploaded?</summary>
                <div class="faq-content" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                    <p itemprop="text">No. All conversion happens locally inside your browser using JavaScript and HTML5 Canvas. Your files never leave your device, ensuring total privacy.</p>
                </div>
            </details>

            <details itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Why convert to PNG?</summary>
                <div class="faq-content" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                    <p itemprop="text">While WebP is efficient for the web, many image editors and legacy software do not support it natively. PNG ensures universal compatibility with transparency support.</p>
                </div>
            </details>

            <details itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Is there a file limit?</summary>
                <div class="faq-content" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                    <p itemprop="text">Desktop is unlimited (RAM dependent). Mobile is capped at ~50MB for stability to prevent browser crashes.</p>
                </div>
            </details>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Architect Zero. Serverless. Private. Open Source.</p>
    </footer>

    <script>
        'use strict';

        // ==========================================
        // VENDORIZED MICRO-ZIP ENGINE
        // ==========================================
        class JSZip {
            constructor() { this.files = []; this.encoder = new TextEncoder(); }
            file(name, blob) { this.files.push({ name, blob, date: new Date() }); return this; }
            async generateAsync(options) {
                const PK_LOCAL_HEADER = 0x04034b50, PK_CENTRAL_HEADER = 0x02014b50, PK_END_HEADER = 0x06054b50;
                const parts = [], centralDir = [];
                let offset = 0;
                const crcTable = new Int32Array(256);
                for (let i = 0; i < 256; i++) {
                    let c = i;
                    for (let k = 0; k < 8; k++) c = (c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1);
                    crcTable[i] = c;
                }
                const crc32 = (arr) => {
                    let crc = -1;
                    for (let i = 0; i < arr.length; i++) crc = (crc >>> 8) ^ crcTable[(crc ^ arr[i]) & 0xFF];
                    return (crc ^ -1) >>> 0;
                };
                for (const file of this.files) {
                    const nameBytes = this.encoder.encode(file.name);
                    const buffer = await file.blob.arrayBuffer();
                    const data = new Uint8Array(buffer);
                    const crc = crc32(data), size = data.length;
                    const d = file.date;
                    const time = (d.getHours() << 11) | (d.getMinutes() << 5) | (d.getSeconds() >> 1);
                    const date = ((d.getFullYear() - 1980) << 9) | ((d.getMonth() + 1) << 5) | d.getDate();
                    const header = new Uint8Array(30 + nameBytes.length);
                    const view = new DataView(header.buffer);
                    view.setUint32(0, PK_LOCAL_HEADER, true); view.setUint16(4, 10, true); view.setUint16(6, 0, true);
                    view.setUint16(8, 0, true); view.setUint16(10, time, true); view.setUint16(12, date, true);
                    view.setUint32(14, crc, true); view.setUint32(18, size, true); view.setUint32(22, size, true);
                    view.setUint16(26, nameBytes.length, true); view.setUint16(28, 0, true); header.set(nameBytes, 30);
                    parts.push(header); parts.push(data);
                    const cdr = new Uint8Array(46 + nameBytes.length);
                    const cdrView = new DataView(cdr.buffer);
                    cdrView.setUint32(0, PK_CENTRAL_HEADER, true); cdrView.setUint16(4, 10, true); cdrView.setUint16(6, 10, true);
                    cdrView.setUint16(8, 0, true); cdrView.setUint16(10, 0, true); cdrView.setUint16(12, time, true);
                    cdrView.setUint16(14, date, true); cdrView.setUint32(16, crc, true); cdrView.setUint32(20, size, true);
                    cdrView.setUint32(24, size, true); cdrView.setUint16(28, nameBytes.length, true); cdrView.setUint16(30, 0, true);
                    cdrView.setUint16(32, 0, true); cdrView.setUint16(34, 0, true); cdrView.setUint16(36, 0, true);
                    cdrView.setUint32(38, 0, true); cdrView.setUint32(42, offset, true); cdr.set(nameBytes, 46);
                    centralDir.push(cdr); offset += header.length + size;
                }
                const cdrTotalSize = centralDir.reduce((acc, val) => acc + val.length, 0);
                const endHeader = new Uint8Array(22);
                const endView = new DataView(endHeader.buffer);
                endView.setUint32(0, PK_END_HEADER, true); endView.setUint16(4, 0, true); endView.setUint16(6, 0, true);
                endView.setUint16(8, this.files.length, true); endView.setUint16(10, this.files.length, true);
                endView.setUint32(12, cdrTotalSize, true); endView.setUint32(16, offset, true); endView.setUint16(20, 0, true);
                return new Blob([...parts, ...centralDir, endHeader], { type: options.type || 'application/zip' });
            }
        }

        // ==========================================
        // APPLICATION LOGIC
        // ==========================================
        
        // DOM
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressPercent = document.getElementById('progressPercent');
        const btnDownloadAll = document.getElementById('btnDownloadAll');
        const btnReset = document.getElementById('btnReset');
        const actionArea = document.getElementById('actionArea');
        const mobileWarning = document.getElementById('mobileWarning');

        // State
        let convertedFiles = []; 
        let isProcessing = false;

        // Utility: Check if device is likely mobile/tablet
        const isMobileDevice = () => {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || (window.innerWidth < 800);
        };

        // Event Listeners
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault(); e.stopPropagation();
                dropZone.classList.add('drag-over');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault(); e.stopPropagation();
                dropZone.classList.remove('drag-over');
            }, false);
        });

        dropZone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            handleFiles(dt.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            e.target.value = ''; 
        });

        btnReset.addEventListener('click', resetInterface);

        btnDownloadAll.addEventListener('click', async () => {
            if (convertedFiles.length === 0) return;
            const btnOriginalText = btnDownloadAll.innerHTML;
            btnDownloadAll.disabled = true;
            btnDownloadAll.textContent = "Compressing...";

            try {
                const zip = new JSZip();
                convertedFiles.forEach(file => zip.file(file.name, file.blob));
                const content = await zip.generateAsync({ type: "application/zip" });
                const url = URL.createObjectURL(content);
                triggerDownload(url, `architect-zero-converted-${Date.now()}.zip`);
                setTimeout(() => URL.revokeObjectURL(url), 2000);
            } catch (error) {
                alert("Error generating ZIP. Insufficient memory.");
                console.error(error);
            } finally {
                btnDownloadAll.disabled = false;
                btnDownloadAll.innerHTML = btnOriginalText;
            }
        });

        function resetInterface() {
            if(isProcessing) return; 
            convertedFiles.forEach(f => { if(f.blob) URL.revokeObjectURL(f.blob); });
            convertedFiles = [];
            fileList.innerHTML = '';
            actionArea.style.display = 'none';
            progressContainer.style.display = 'none';
            mobileWarning.style.display = 'none';
            dropZone.style.display = 'block';
        }

        async function handleFiles(files) {
            if (isProcessing || files.length === 0) return;
            isProcessing = true;
            dropZone.style.display = 'none'; 
            fileList.innerHTML = '';
            convertedFiles = [];
            actionArea.style.display = 'none';
            mobileWarning.style.display = 'none';
            progressContainer.style.display = 'block';
            updateProgress(0, files.length);

            const fileArray = Array.from(files);
            let processedCount = 0;
            let currentTotalSize = 0; // Acumulador de seguranÃ§a

            for (const file of fileArray) {
                if (!file.type.startsWith('image/')) {
                    addToList(file.name, null, 'Ignored');
                    processedCount++;
                    updateProgress(processedCount, fileArray.length);
                    continue;
                }

                try {
                    const pngBlob = await convertWebPToPNG(file);
                    const safeName = file.name.replace(/\.[^/.]+$/, "") + ".png";
                    
                    // LÃ³gica de AcumulaÃ§Ã£o e Disjuntor Mobile
                    currentTotalSize += pngBlob.size;
                    
                    if (isMobileDevice() && currentTotalSize > 50 * 1024 * 1024) { // 50MB Limit
                        convertedFiles.push({ name: safeName, blob: pngBlob });
                        addToList(safeName, pngBlob, 'Success');
                        processedCount++;
                        updateProgress(processedCount, fileArray.length);
                        
                        // Break circuit
                        alert('Memory Protection Active: Total size exceeds 50MB. ZIP download disabled to prevent browser crash. Please download files individually.');
                        break; 
                    }

                    convertedFiles.push({ name: safeName, blob: pngBlob });
                    addToList(safeName, pngBlob, 'Success');

                } catch (error) {
                    console.error(error);
                    addToList(file.name, null, 'Error');
                }
                processedCount++;
                updateProgress(processedCount, fileArray.length);
                await new Promise(r => setTimeout(r, 20)); // Yield UI
            }

            finishProcessing();
        }

        function convertWebPToPNG(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const objectUrl = URL.createObjectURL(file);
                img.onload = () => {
                    URL.revokeObjectURL(objectUrl);
                    // Safe Limit for Mobile Canvas
                    const MAX_PIXELS = 16 * 1024 * 1024; // 16MP
                    if (img.width * img.height > MAX_PIXELS && isMobileDevice()) {
                        reject(new Error("Image dimensions too large for mobile memory"));
                        return;
                    }
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    canvas.toBlob((blob) => {
                        if (blob) resolve(blob);
                        else reject(new Error("Conversion failed"));
                    }, 'image/png');
                };
                img.onerror = () => {
                    URL.revokeObjectURL(objectUrl);
                    reject(new Error("Image load error"));
                };
                img.src = objectUrl;
            });
        }

        function updateProgress(current, total) {
            const percent = total === 0 ? 0 : Math.round((current / total) * 100);
            progressFill.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            progressText.textContent = `Processing ${current} of ${total}...`;
        }

        function finishProcessing() {
            isProcessing = false;
            progressText.textContent = "Done";
            actionArea.style.display = 'flex';

            if (convertedFiles.length > 0) {
                // CÃ¡lculo total para exibiÃ§Ã£o
                const totalBytes = convertedFiles.reduce((acc, f) => acc + f.blob.size, 0);
                const LIMIT_MB = 50 * 1024 * 1024; // 50MB

                if (isMobileDevice() && totalBytes > LIMIT_MB) {
                    // Disable ZIP, show Warning
                    btnDownloadAll.style.display = 'none';
                    mobileWarning.style.display = 'block';
                } else {
                    // Allow ZIP
                    btnDownloadAll.style.display = 'inline-flex';
                    btnDownloadAll.innerHTML = `
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download ZIP (${formatBytes(totalBytes)})`;
                    mobileWarning.style.display = 'none';
                }
            } else {
                btnDownloadAll.style.display = 'none';
            }
        }

        function formatBytes(bytes) {
            if(bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function addToList(fileName, blob, status) {
            const div = document.createElement('div');
            div.className = 'file-item';
            
            // Logic string comparison updated to English
            let statusClass = status === 'Success' ? 'status-done' : (status === 'Error' ? 'status-error' : 'status-pending');
            
            div.innerHTML = `
                <div class="file-info">
                    <span class="file-name" title="${fileName}">${fileName}</span>
                    <span class="status-badge ${statusClass}">${status}</span>
                </div>
            `;

            if (blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.className = 'single-dl-link';
                a.textContent = 'Download';
                div.appendChild(a);
            }
            fileList.appendChild(div);
        }

        function triggerDownload(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "41fdc812a81a40d5b915675a356be731"}'></script>
</body>
</html>